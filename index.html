<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英語が話せるようになる！初級者向け英語学習ガイド</title>
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="英語学習">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <h1>英語が話せるようになる！</h1>
    <p>初級者のための英語学習ガイド ー ゼロから始めても大丈夫！</p>
</header>

<nav id="main-nav">
    <button class="active" onclick="showSection('lessons', this)">レッスン</button>
    <button onclick="showSection('speaking', this)">発音・会話練習</button>
    <button onclick="showSection('reference', this)">リファレンス</button>
</nav>

<main>

<!-- ==================== レッスンセクション ==================== -->
<div id="lessons" class="section active">
    <div class="lesson-layout">
        <div class="lesson-sidebar">
            <div class="card">
                <div class="lesson-search-wrap">
                    <input
                        id="lesson-search"
                        type="search"
                        placeholder="🔍 レッスンを検索..."
                        oninput="filterLessons(this.value)"
                    >
                </div>
                <div id="lesson-list-container"></div>
            </div>
        </div>
        <div class="lesson-content" id="lesson-content">
        </div>
    </div>
</div>

<!-- ==================== 発音・会話練習セクション ==================== -->
<div id="speaking" class="section">

    <!-- 発音チェック -->
    <div class="card">
        <h2>発音チェック</h2>
        <p>お手本の英文を聞いてから、マイクボタンを押して発音してみましょう！<br>音声認識であなたの発音を判定します。</p>
        <p style="color:#e53e3e; font-size:0.85rem; margin-top:6px;">※ マイクの使用を許可してください（HTTPS環境が必要です）<br>※ Safariの場合：「設定」→「Webサイト」→「マイク」でこのサイトを許可してください</p>

        <div style="margin: 18px 0;">
            <label for="pronun-category" style="font-weight:bold;">カテゴリを選択：</label>
            <select id="pronun-category" onchange="loadPronunCategory()" style="padding:8px 14px; border-radius:8px; border:2px solid #667eea; font-size:1rem;">
                <option value="greetings">あいさつ</option>
                <option value="daily">日常フレーズ</option>
                <option value="travel">旅行</option>
                <option value="shopping">買い物</option>
                <option value="grammar">基本文法</option>
            </select>
        </div>

        <div id="pronun-sentence-area">
            <div class="pronunciation-check">
                <h3 id="pronun-target-en">Hello, how are you?</h3>
                <p id="pronun-target-ja" style="color:#4a5568; margin-bottom:8px;">こんにちは、お元気ですか？</p>
                <div style="margin-bottom:12px;">
                    <button class="speak-btn" onclick="speak(document.getElementById('pronun-target-en').textContent, this)" style="width:40px;height:40px;font-size:18px;" title="お手本を聞く">&#128264;</button>
                    <span style="font-size:0.85rem; color:#718096;">お手本を聞く</span>
                </div>
                <button id="mic-btn-pronun" class="mic-btn idle" onclick="togglePronunRecording()">&#127908;</button>
                <p style="font-size:0.8rem; color:#718096; margin-top:6px;" id="mic-status-pronun">マイクボタンを押して発音してください</p>
                <div id="pronun-result" class="speech-result"></div>
            </div>
            <div style="display:flex; justify-content:center; gap:12px; margin-top:10px;">
                <button onclick="prevPronunSentence()" style="padding:8px 20px; border:2px solid #667eea; background:white; color:#667eea; border-radius:8px; cursor:pointer; font-weight:bold;">← 前の文</button>
                <span id="pronun-counter" style="padding:8px 14px; font-weight:bold; color:#4a5568;">1 / 5</span>
                <button onclick="nextPronunSentence()" style="padding:8px 20px; border:2px solid #667eea; background:white; color:#667eea; border-radius:8px; cursor:pointer; font-weight:bold;">次の文 →</button>
            </div>
        </div>
    </div>

    <!-- 定型会話練習 -->
    <div class="card">
        <h2>定型会話練習</h2>
        <p>シナリオを選んで、実際の会話を練習しましょう！相手のセリフを聞いてから、あなたのセリフをマイクで話してください。</p>

        <div style="margin: 18px 0;">
            <label for="conv-scenario" style="font-weight:bold;">シナリオを選択：</label>
            <select id="conv-scenario" onchange="loadConversation()" style="padding:8px 14px; border-radius:8px; border:2px solid #667eea; font-size:1rem;">
                <option value="greeting">自己紹介・あいさつ</option>
                <option value="restaurant">レストランで注文</option>
                <option value="shopping">買い物</option>
                <option value="directions">道を聞く</option>
                <option value="hotel">ホテルのチェックイン</option>
            </select>
        </div>

        <div class="conversation-box">
            <div id="conv-messages" class="chat-messages"></div>
            <div class="chat-controls">
                <button id="conv-listen-btn" onclick="playConvLine()" style="background:#4299e1; color:white;">&#128264; 相手のセリフを聞く</button>
                <button id="conv-mic-btn" class="mic-btn idle" onclick="toggleConvRecording()" style="width:50px; height:50px; font-size:22px;">&#127908;</button>
                <button id="conv-skip-btn" onclick="skipConvLine()" style="background:#a0aec0; color:white;">スキップ ▶</button>
            </div>
            <p id="conv-hint" style="text-align:center; margin-top:8px; color:#718096; font-size:0.9rem;"></p>
            <div id="conv-result" class="speech-result" style="text-align:center;"></div>
        </div>
        <div style="text-align:center; margin-top:10px;">
            <button onclick="resetConversation()" style="padding:10px 24px; background:#667eea; color:white; border:none; border-radius:10px; cursor:pointer; font-weight:bold; font-size:1rem;">最初からやり直す</button>
        </div>
    </div>

</div>

<!-- ==================== リファレンスセクション ==================== -->
<div id="reference" class="section">
    <div class="card">
        <h2>基本のあいさつ</h2>
        <table>
            <tr><th>英語</th><th>読み方</th><th>意味</th></tr>
            <tr><td><strong>Hello / Hi</strong></td><td style="color:#e53e3e">ハロー / ハイ</td><td>こんにちは / やあ</td></tr>
            <tr><td><strong>Good morning</strong></td><td style="color:#e53e3e">グッモーニン</td><td>おはようございます</td></tr>
            <tr><td><strong>Good afternoon</strong></td><td style="color:#e53e3e">グッアフタヌーン</td><td>こんにちは</td></tr>
            <tr><td><strong>Good evening</strong></td><td style="color:#e53e3e">グッイーヴニン</td><td>こんばんは</td></tr>
            <tr><td><strong>Goodbye / Bye / See you</strong></td><td style="color:#e53e3e">グッバイ / バイ / スィーユー</td><td>さようなら / またね</td></tr>
            <tr><td><strong>Thank you</strong></td><td style="color:#e53e3e">サンキュー</td><td>ありがとう</td></tr>
            <tr><td><strong>You're welcome</strong></td><td style="color:#e53e3e">ユアウェルカム</td><td>どういたしまして</td></tr>
            <tr><td><strong>Sorry / Excuse me</strong></td><td style="color:#e53e3e">ソーリー / エクスキューズミー</td><td>ごめんなさい / すみません</td></tr>
        </table>
    </div>
    <div class="card">
        <h2>困ったときのフレーズ</h2>
        <table>
            <tr><th>英語</th><th>読み方</th><th>意味</th></tr>
            <tr><td>I don't understand.</td><td style="color:#e53e3e">アイ ドント アンダスタンド</td><td>わかりません</td></tr>
            <tr><td>Could you say that again?</td><td style="color:#e53e3e">クッジュー セイ ダット アゲン？</td><td>もう一度言ってもらえますか？</td></tr>
            <tr><td>Could you speak more slowly?</td><td style="color:#e53e3e">クッジュー スピーク モア スローリー？</td><td>もっとゆっくり話してもらえますか？</td></tr>
            <tr><td>Where is the restroom?</td><td style="color:#e53e3e">ウェア イズ ザ レストルーム？</td><td>トイレはどこですか？</td></tr>
            <tr><td>Can you help me?</td><td style="color:#e53e3e">キャンユー ヘルプミー？</td><td>助けてもらえますか？</td></tr>
        </table>
    </div>
    <div class="card">
        <h2>レストラン・買い物フレーズ</h2>
        <table>
            <tr><th>英語</th><th>意味</th></tr>
            <tr><td>Can I have the menu, please?</td><td>メニューをいただけますか？</td></tr>
            <tr><td>I'd like this one, please.</td><td>これをお願いします。</td></tr>
            <tr><td>Check, please.</td><td>お会計をお願いします。</td></tr>
            <tr><td>How much is this?</td><td>これはいくらですか？</td></tr>
            <tr><td>I'll take this.</td><td>これをください。</td></tr>
            <tr><td>Can I pay by card?</td><td>カードで払えますか？</td></tr>
        </table>
    </div>
    <div class="card">
        <h2>空港・機内フレーズ</h2>
        <table>
            <tr><th>英語</th><th>意味</th></tr>
            <tr><td>Where is the boarding gate?</td><td>搭乗口はどこですか？</td></tr>
            <tr><td>I'd like to check in my baggage.</td><td>荷物を預けたいです</td></tr>
            <tr><td>I'd like a window seat, please.</td><td>窓側の席をお願いします</td></tr>
            <tr><td>Can I carry this on board?</td><td>これは機内持ち込みできますか？</td></tr>
            <tr><td>Could I have a blanket, please?</td><td>毛布をもらえますか？</td></tr>
        </table>
    </div>
    <div class="card">
        <h2>入国審査・税関フレーズ</h2>
        <table>
            <tr><th>英語</th><th>意味</th></tr>
            <tr><td>I'm here for sightseeing.</td><td>観光で来ました</td></tr>
            <tr><td>I'll be staying for one week.</td><td>1週間滞在します</td></tr>
            <tr><td>I'll be staying at a hotel.</td><td>ホテルに泊まります</td></tr>
            <tr><td>I have nothing to declare.</td><td>申告するものはありません</td></tr>
            <tr><td>May I see your passport?</td><td>パスポートを見せてください（係員側）</td></tr>
        </table>
    </div>
    <div class="card">
        <h2>ホテルフレーズ</h2>
        <table>
            <tr><th>英語</th><th>意味</th></tr>
            <tr><td>I'd like to check in.</td><td>チェックインしたいです</td></tr>
            <tr><td>I have a reservation under Yamada.</td><td>予約をしています（名前：山田）</td></tr>
            <tr><td>What's the Wi-Fi password?</td><td>Wi-Fiのパスワードは？</td></tr>
            <tr><td>Could I have extra towels, please?</td><td>タオルを追加でください</td></tr>
            <tr><td>The air conditioner isn't working.</td><td>エアコンが動きません</td></tr>
        </table>
    </div>
    <div class="card">
        <h2>レストラン追加フレーズ</h2>
        <table>
            <tr><th>英語</th><th>意味</th></tr>
            <tr><td>A table for two, please.</td><td>2人席をお願いします</td></tr>
            <tr><td>Could I see the menu?</td><td>メニューを見せてください</td></tr>
            <tr><td>What do you recommend?</td><td>おすすめは何ですか？</td></tr>
            <tr><td>I'm allergic to nuts.</td><td>アレルギーがあります（例：ナッツ）</td></tr>
            <tr><td>Can we pay separately?</td><td>別々に払えますか？</td></tr>
        </table>
    </div>
    <div class="card">
        <h2>ショッピング追加フレーズ</h2>
        <table>
            <tr><th>英語</th><th>意味</th></tr>
            <tr><td>Can I try this on?</td><td>試着してもいいですか？</td></tr>
            <tr><td>Do you have a different size?</td><td>別のサイズはありますか？</td></tr>
            <tr><td>Do you accept credit cards?</td><td>カードで払えますか？</td></tr>
            <tr><td>Could I have a bag?</td><td>袋をもらえますか？</td></tr>
        </table>
    </div>
    <div class="card">
        <h2>交通・道案内フレーズ</h2>
        <table>
            <tr><th>英語</th><th>意味</th></tr>
            <tr><td>I'd like to go to ~.</td><td>～へ行きたいのですが</td></tr>
            <tr><td>Could you take me here, please?</td><td>ここへ連れて行ってください</td></tr>
            <tr><td>How long does it take on foot?</td><td>歩いてどのくらいかかりますか？</td></tr>
            <tr><td>What's the next stop?</td><td>次の停留所はどこですか？</td></tr>
            <tr><td>Could you drop me off here?</td><td>ここで降りていいですか？</td></tr>
        </table>
    </div>
    <div class="card">
        <h2>トラブル・緊急フレーズ</h2>
        <table>
            <tr><th>英語</th><th>意味</th></tr>
            <tr><td>Help!</td><td>助けてください！</td></tr>
            <tr><td>My wallet was stolen.</td><td>財布を盗まれました</td></tr>
            <tr><td>Where is the Japanese embassy?</td><td>日本大使館はどこですか？</td></tr>
            <tr><td>I'm not feeling well.</td><td>気分が悪いです</td></tr>
            <tr><td>Please take me to a hospital.</td><td>病院に連れて行ってください</td></tr>
        </table>
    </div>
    <div class="card">
        <h2>便利な一言フレーズ</h2>
        <table>
            <tr><th>英語</th><th>意味</th></tr>
            <tr><td>My English isn't very good.</td><td>英語が得意ではありません</td></tr>
            <tr><td>Where is ~?</td><td>～はどこですか？</td></tr>
            <tr><td>No, thank you. / I'm good.</td><td>大丈夫です（不要です）</td></tr>
        </table>
    </div>
</div>

</main>

<footer>
    <p>英語学習ガイド - あきらめなければ、必ず話せるようになる！</p>
</footer>

<script src="api.js"></script>
<script src="script.js"></script>

<!-- PWA Service Worker 登録 -->
<script>
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('/english-study/sw.js')
            .then(function(reg) { console.log('SW registered:', reg.scope); })
            .catch(function(err) { console.log('SW registration failed:', err); });
    });
}
</script>

</body>
</html>
